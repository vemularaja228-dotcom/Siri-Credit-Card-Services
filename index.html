<script>
document.addEventListener("DOMContentLoaded", function () {

  // Safe element references
  const amountAddedEl = document.getElementById('amountAdded');
  const bankAmountEl  = document.getElementById('bankAmount');
  const platformEl    = document.getElementById('platform');
  const additionalEl  = document.getElementById('additional');
  const receiptEl     = document.getElementById('receiptOutput');

  // Auto-clear logic
  amountAddedEl.addEventListener('input', () => {
    bankAmountEl.value = '';
  });

  bankAmountEl.addEventListener('input', () => {
    amountAddedEl.value = '';
  });

  // Expose functions globally (for button onclick)
  window.calculate = function () {
    const added = parseFloat(amountAddedEl.value);
    const bank  = parseFloat(bankAmountEl.value);
    const rate  = parseFloat(platformEl.value) / 100;
    const fixed = parseFloat(additionalEl.value);
    const date  = new Date().toLocaleString();

    let amount, platformFee, totalFee, toBank;

    if (!isNaN(added)) {
      amount = added;
      platformFee = amount * rate;
      totalFee = platformFee + fixed;
      toBank = amount - totalFee;

    } else if (!isNaN(bank)) {
      toBank = bank;
      amount = (toBank + fixed) / (1 - rate);
      platformFee = amount * rate;
      totalFee = platformFee + fixed;

    } else {
      alert("Enter Amount Added OR Final Bank Amount");
      return;
    }

    receiptEl.innerText =
`-------------------------------
Siri Credit Card Services
Transaction Receipt
-------------------------------
Date       : ${date}
Handled By : Sagar
Contact    : 9959787923

Amount     : ₹${amount.toFixed(2)}
Platform % : ${(rate * 100).toFixed(2)}%
Platform ₹ : ₹${platformFee.toFixed(2)}
Add. Fee   : ₹${fixed.toFixed(2)}
-------------------------------
Total Fee  : ₹${totalFee.toFixed(2)}
To Bank    : ₹${toBank.toFixed(2)}
-------------------------------
Thank you for choosing us!`;
  };

  window.copyReceipt = function () {
    if (!receiptEl.innerText.trim()) {
      alert("Generate receipt first");
      return;
    }
    navigator.clipboard.writeText(receiptEl.innerText);
    alert("Receipt copied!");
  };

  window.shareWhatsApp = function () {
    if (!receiptEl.innerText.trim()) {
      alert("Generate receipt first");
      return;
    }
    window.open(
      "https://wa.me/?text=" + encodeURIComponent(receiptEl.innerText),
      "_blank"
    );
  };

});
</script>
